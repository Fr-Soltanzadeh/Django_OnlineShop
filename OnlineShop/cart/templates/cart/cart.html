{% extends 'base.html' %}
{% load static %}

{% block title %}
 Cart
{% endblock %}

{% block content %}
{% include 'header.html' %}    

        <div class="breadcrumb-area bg-gray">
            <div class="container">
                <div class="breadcrumb-content text-center">
                    <ul>
                        <li>
                            <a href="{% url 'home' %}">Home</a>
                        </li>
                        <li class="active">Cart Page </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="cart-main-area pt-115 pb-120">
            <div class="container">
                <h3 class="cart-page-title">Your cart items</h3>
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-12">
                        <form action="#">
                            <div class="table-content table-responsive cart-table-content">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Image</th>
                                            <th>Product Name</th>
                                            <th>Price</th>
                                            <th>Quantity</th>
                                            <th>Subtotal</th>
                                            <th>action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cart_items">
                                        
                                    </tbody>
                                </table>
                            </div>
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="cart-shiping-update-wrapper">
                                        <div class="cart-shiping-update">
                                            <a href="{%url 'products' %}">Continue Shopping</a>
                                        </div>
                                        <div class="cart-clear">
                                            <button>Update Cart</button>
                                            <a href="#">Clear Cart</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <div class="row justify-content-between">
                            <div class="col-lg-4 col-md-6">
                                <div class="discount-code-wrapper">
                                    <div class="title-wrap">
                                        <h4 class="cart-bottom-title section-bg-gray">Use Coupon Code</h4>
                                    </div>
                                    <div class="discount-code">
                                        <p>Enter your coupon code if you have one.</p>
                                        <form>
                                            <input type="text" required="" name="name">
                                            <button class="cart-btn-2" type="submit">Apply Coupon</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-md-12">
                                <div class="grand-totall">
                                    <div class="title-wrap">
                                        <h4 class="cart-bottom-title section-bg-gary-cart">Cart Total</h4>
                                    </div>
                                    <h5>Total products <span>$260.00</span></h5>
                                    <div class="total-shipping">
                                        <h5>Total shipping</h5>
                                        <ul>
                                            <li><input type="checkbox"> Standard <span>$20.00</span></li>
                                            <li><input type="checkbox"> Express <span>$30.00</span></li>
                                        </ul>
                                    </div>
                                    <h4 class="grand-totall-title">Grand Total <span>$260.00</span></h4>
                                    <a href="#">Proceed to Checkout</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    

    {% include 'footer.html' %}

    <script>
     window.onload= function() {
            const url ="api/"
            fetch(url,{
                method:'GET',
            })
            .then(
                response=>{
                    if (response.ok){
                        return response.json();
                    }
                    else  {
                        throw new Error('not connected');
                    }
                }
            )
            .then((data) => {
                let cart = data.cartItems;
                let main=document.getElementById("cart_items")
                cart.map(function(cart_item) {
                    let tr = document.createElement('tr');
                    tr.id = `r${cart_item.product.id}`

                    let td_img = document.createElement('td');
                    td_img.classList.add('product-thumbnail');
                    a_img = document.createElement('a');
                    img = document.createElement('img');
                    img.style.height="112px"
                    img.src=cart_item.product.images[0].image
                    img.alt="product_image"
                    a_img.appendChild(img)
                    td_img.appendChild(a_img)
                    tr.appendChild(td_img);

                    let td_name = document.createElement('td');
                    td_name.classList.add('product-name');
                    a_name = document.createElement('a');
                    a_name.innerHTML=cart_item.product.title
                    td_name.appendChild(a_name)
                    tr.appendChild(td_name);

                    let td_price = document.createElement('td');
                    td_price.classList.add('product-price-cart');
                    span_price = document.createElement('a');
                    span_price.classList.add('amount');
                    span_price.innerHTML=cart_item.product.price
                    td_price.appendChild(span_price)
                    tr.appendChild(td_price);

                    let td_quantity = document.createElement('td');
                    td_quantity.classList.add('product-quantity', 'pro-details-quality');
                    let div_quantity = document.createElement('div');
                    div_quantity.classList.add('cart-plus-minus');
                    let div_minus = document.createElement('div');
                    div_minus.classList.add('qtybutton','dec');
                    div_minus.innerHTML="-"
                    let input = document.createElement('input');
                    input.classList.add('cart-plus-minus-box');
                    input.id=`q${cart_item.product.id}`
                    input.type="text"; 
                    input.name="qtybutton" 
                    input.value=cart_item.quantity
                    div_quantity.appendChild(div_minus)
                    div_quantity.appendChild(input)
                    let div_plus = document.createElement('div');
                    div_plus.classList.add('qtybutton','inc');
                    div_plus.innerHTML="+"
                    div_plus.setAttribute("onclick",`add_item(${cart_item.product.id})`);
                    div_quantity.appendChild(div_plus)
                    td_quantity.appendChild(div_quantity)
                    tr.appendChild(td_quantity);

                    let td_subtotal = document.createElement('td');
                    td_subtotal.classList.add('product-subtotal');
                    td_subtotal.innerHTML=(+cart_item.product.price)*(+cart_item.quantity)
                    tr.appendChild(td_subtotal);

                    let td_remove = document.createElement('td');
                    td_remove.classList.add('product-remove');
                    a_remove = document.createElement('a');
                    i_remove= document.createElement('i');
                    i_remove.classList.add("icon_trash")
                    a_remove.appendChild(i_remove)
                    a_remove.setAttribute("onclick",`remove_item(${cart_item.product.id})`);
                    td_remove.appendChild(a_remove)
                    tr.appendChild(td_remove);

                    main.appendChild(tr);
                    
                });
                
                })
            .catch(function(error) {
                console.log(error);
            });                    
        }
        function add_item(ItemId) {
            console.log(`inc:q${ItemId}`)
            let quantity=document.getElementById(`q${ItemId}`)
            console.log("before:")
            console.log(quantity.value)
            quantity.value=Number(quantity.value)+1
            console.log("after:")
            console.log(quantity.value)
        }
        function decrease_item(ItemId) {
            console.log(`dec:q${ItemId}`)
            let quantity=document.getElementById(`q${ItemId}`)
            console.log("before:")
            console.log(quantity.value)
            quantity.value=Number(quantity.value)-1
            console.log("after:")
            console.log(quantity.value)
            
            if (quantity.value <=0){
                remove_item(ItemId)
            }
        }
        function remove_item(ItemId) {
            let quantity=document.getElementById(`r${ItemId}`)
            quantity.remove()
        } 
    </script>
    {% endblock %}
